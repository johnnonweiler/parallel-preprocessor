<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>parallel-preprocessor: Build on Linux</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">parallel-preprocessor
   &#160;<span id="projectnumber">0.3.0.3ee9e97</span>
   </div>
   <div id="projectbrief">MPI distributive and multithreading massively parallel geometry processor     for large scale CAE and machine learning, by Qingfeng Xia, UKAEA, 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_wiki_BuildOnLinux.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Build on Linux </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Install Dependencies</h1>
<p>Note <b>Ubuntu and Fedora docker images with all dependencies are ready for quick testing.</b></p>
<h2>Install from the pre-built binary package</h2>
<p>In short, if FreeCAD has been installed, all the runtime dependencies such OpenCASCADE, TBB, would have been installed.</p>
<p>For example, on Ubuntu 18.04 </p><div class="fragment"><div class="line"># assume FreeCAD ppa has been added to your repository list</div>
<div class="line">sudo add-apt-repository ppa:freecad-maintainers/freecad-stable</div>
<div class="line">sudo apt update</div>
<div class="line">sudo install freecad</div>
<div class="line">sudo apt-get install libtbb2 libocct-foundation-7.3  libocct-data-exchange-7.3  libocct-modeling-data-7.3 libocct-modeling-algorithms-7.3  libocct-ocaf-7.3</div>
<div class="line"># download the deb</div>
<div class="line">sudo dpkg -i parallel-preprocessor*.deb</div>
</div><!-- fragment --><h3>packages needed to build or develop</h3>
<p>note: <b>package name are debian based</b>, see installation section for RedHat based operation systems</p>
<ul>
<li>C++17 compiler is also needed.</li>
<li>essential build tool: cmake, git, etc</li>
<li><code>libtbb2-dev</code>: thread pool</li>
<li>OpenCASCADE (<code>libocct*-dev</code> and <code>occt-misc</code>) can be installed from freecad-daily PPA ubuntu has opencascade with dbgsym, but its version is too outdated. <a href="https://launchpad.net/ubuntu/+source/opencascade">https://launchpad.net/ubuntu/+source/opencascade</a></li>
<li><code>python3-dev</code> pybind11 is now a submodule</li>
</ul>
<h3>Optional dependencies:</h3>
<ul>
<li><code>boost</code>: if C++17 compiler is not available, <code>boost::any</code> and <code>boost::filesystem</code></li>
<li><code>freecad</code> or <code>freecad-daily</code>: to view result and test, using the freecad-python3</li>
<li><code>doxygen</code>: for in-source documentation generation</li>
<li><code>zlib</code> and zipiso++: for zipped stream IO: used by FreeCAD project, simulate java.zipfile API</li>
</ul>
<p>Future dependencies:</p><ul>
<li><code>openmpi, libscotch, libhypre</code>, can be installed with fenics from Fenics PPA</li>
<li><code>Qt</code> for GUI 3D viewer</li>
</ul>
<p>If you follow the official guide and you can build FreeCAD-daily 0.19 (python3 is strongly recommended), you should get the OpenCASCADE 7.3 dev from their PPA repo.</p>
<p>There are some third-party libraries already integrated into the source code tree, see more details on software design wiki page</p>
<hr  />
<h2>Build from source</h2>
<p>Tested compiler: g++ 7.x, g++8.x, clang 6 (needs CMake 3.13+ )</p>
<p>To use clang toolchain, use the following cmake command option. </p><div class="fragment"><div class="line">cmake -T llvm </div>
<div class="line"># llvm-10, to specify the linker app: lld-link</div>
</div><!-- fragment --><h2>Method 1: building on local Linux</h2>
<h3>Ubuntu 18.04 and 20.04</h3>
<p>The dependency is similar as Ubuntu 18.04, except OpenCASCADE is not installed from FreeCAD PPA, but Ubuntu official repository (version 7.3.3).</p>
<div class="fragment"><div class="line"># this repo contains submodule:</div>
<div class="line"># for user clone this repo, git should automatically download all submodules, </div>
<div class="line"># if not, or not sure, just run</div>
<div class="line">git submodule update --init --recursive</div>
<div class="line"># otherwise, you will be warmed by cmake to run this command</div>
<div class="line"> </div>
<div class="line"># install compulsory dependencies</div>
<div class="line">sudo apt-get install git cmake doxygen ccache g++</div>
<div class="line"> </div>
<div class="line"># add freecad-stable or freecad-daily ppa (for ubuntu 18.04)</div>
<div class="line">source /etc/lsb-release  # help to detect ubuntu version, </div>
<div class="line"># $(lsb_release -c -s)</div>
<div class="line">if [ &quot;$DISTRIB_CODENAME&quot; == &quot;bionic&quot; ]; then</div>
<div class="line">add-apt-repository ppa:freecad-maintainers/freecad-daily  &amp;&amp;  apt-get update</div>
<div class="line">apt-get install -y freecad-daily-python3 </div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">if [ &quot;$DISTRIB_CODENAME&quot; == &quot;focal&quot; ]; then</div>
<div class="line">echo &quot;libocct 7.3 can be installed from official repo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">sudo apt-get install libocct*-dev occt*</div>
<div class="line">sudo apt-get install python3-dev libtbb-dev</div>
<div class="line"> </div>
<div class="line"># libocct some module depends on Xwindows system, although</div>
<div class="line">sudo apt-get install libx11-dev libxmu-dev libxi-dev</div>
<div class="line"> </div>
<div class="line">############ optional ######################</div>
<div class="line">sudo apt-get install libboost-dev</div>
<div class="line"> </div>
<div class="line"># Qt interface,  see the gitlab CI scrypt for the most updated </div>
<div class="line"> </div>
<div class="line">#pybind11 has been added as a submodule, there is no need to install</div>
<div class="line">#if you can prefer a system-wide install, uncomment the following line</div>
<div class="line"># sudo apt-get install python3-pybind11 pybind11-dev</div>
<div class="line"> </div>
<div class="line"># read zipped data folder,  cmake has FindZLIB, version 1.5, optional </div>
<div class="line">#sudo apt-get install zlib-dev  libzipiso++-dev</div>
</div><!-- fragment --><h3>Fedora29+ and Centos8</h3>
<p>Tested out on fedora 30, but it should work for fedora 29+ ,see <a href="./Dockerfile_fedora">dockerfile for fedora</a></p>
<p>Fedora 31 and 32 have OpenCASCADE in repository, there is no needs to compile from source.</p>
<ol type="1">
<li>install dependencies <div class="fragment"><div class="line">#this script is extracted from dockerfile</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># you must update before any yum install or add a repo</div>
<div class="line">#fedora30 has the default python as python3</div>
<div class="line"># `copr-cli` is needed to to add copr repo</div>
<div class="line">yum install copr-cli -y &amp;&amp; yum update -y </div>
<div class="line"> </div>
<div class="line"># g++ 9.2 for f30 high enough, there is no need to install boost-devel</div>
<div class="line">yum install g++ cmake make git doxygen -y</div>
<div class="line"> </div>
<div class="line"># python3</div>
<div class="line">yum install python3 python3-devel  -y </div>
<div class="line"> </div>
<div class="line"># optionally, install version 2.x of zipios++,  https://github.com/Zipios/Zipios</div>
<div class="line"># not in use for the moment</div>
<div class="line"># yum install zipios zipios-devel -y</div>
<div class="line"> </div>
<div class="line">############## optional ####################</div>
<div class="line"># Qt5 is optional for GUI operation</div>
<div class="line">yum install qt5-devel qt5-qtwebsockets-devel qt5-qtwebsockets -y</div>
</div><!-- fragment --></li>
<li>Install OpenCASCADE 7.x</li>
</ol>
<p>2.1 option 1: Install opencascade 7.4 from package repository For fedora 30+ since Jan 2020, there are freecad (python3) and opencascade 7.4 in repository to install</p>
<div class="fragment"><div class="line"># opencascade 7.4 package  for fedora 30+ is available  </div>
<div class="line">yum install opencascade-draw, opencascade-foundation,  opencascade-modeling,  opencascade-ocaf \</div>
<div class="line">    opencascade-visualization opencascade-devel freecad -y</div>
</div><!-- fragment --><p>2.2 Option 2: Download the opencascade source code and compile from source, if not in package repository</p>
<div class="fragment"><div class="line">###### dependencies needed to build OpenCASCADE from source ##########</div>
<div class="line"># for OpenCASCADE, openGL is needed</div>
<div class="line">yum install tbb tbb-devel freetype freetype-devel freeimage freeimage-devel -y \</div>
<div class="line">        &amp;&amp; yum install libXmu-devel libXi-devel glew-devel SDL2-devel SDL2_image-devel glm-devel -y</div>
<div class="line"># install those below if draw module is enabled for building OpenCASCADE</div>
<div class="line">yum install tk tcl tk-devel tcl-devel -y</div>
<div class="line"> </div>
<div class="line"># package name distinguish capital letter, while debian name is just  libxmu</div>
<div class="line">yum install  openmpi-devel boost-devel -y</div>
</div><!-- fragment --><p>To get the latest source code from <a href="https://www.opencascade.com/">OCCT official website</a>, you need register (free of charge)</p>
<p>Note for UKAEA users: I put the source code on UKAEA one drive to share: user your webbrowser with UKAEA email login to open the link, otherwise login in office 365 <a href="https://ukaeauk-my.sharepoint.com/:u:/g/personal/qingfeng_xia_ukaea_uk/Efs6Dhazcb1MtH44bCyYSqUBpJ2nzvbb3wgytEjYtLIhXA?e=uo32mf">https://ukaeauk-my.sharepoint.com/:u:/g/personal/qingfeng_xia_ukaea_uk/Efs6Dhazcb1MtH44bCyYSqUBpJ2nzvbb3wgytEjYtLIhXA?e=uo32mf</a></p>
<div class="fragment"><div class="line">cd opencascade*</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j$(nproc)</div>
<div class="line">make install</div>
<div class="line"># by default install to the prefix: /usr/local/</div>
</div><!-- fragment --><h2>Compile parallel-preprocessor</h2>
<p>CMake build system is employed to simplify cross-platform development</p>
<div class="fragment"><div class="line">git clone https://github.com/UKAEA/parallel-preprocessor.git</div>
<div class="line">git submodule update --init --recursive</div>
<div class="line"> </div>
<div class="line">#git clone (outside docker is easier for this non-public repo, to avoid trouble in authentication)</div>
<div class="line"> </div>
<div class="line">cd parallel-preprocessor</div>
<div class="line">#</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --><p>If python3 is not detected by pybind11, then <code>cmake -DPYTHON_EXECUTABLE:FILEPATH=$(which python3) ..</code> Qt5 have not yet been configured to compile on fedora in docker</p>
<h2>Method2: use docker image</h2>
<p>This image is based on ubuntu 18.04 with OpenCASCADE and FreeCAD installed. </p><div class="fragment"><div class="line">docker pull qingfengxia/freecad-daily-python3</div>
<div class="line">docker pull qingfengxia/ppp-fedora</div>
<div class="line"> </div>
<div class="line"># cd to your working folder</div>
<div class="line"># I can not git clone this internal repo inside image, so it is done outside docker VM</div>
<div class="line"># git clone will NOT download the external submodule loguru, so run this command</div>
<div class="line">git submodule update --init --recursive</div>
<div class="line"> </div>
<div class="line"># log into this image, using full host path for volume binding</div>
<div class="line">docker run  -ti  -u root -w /home/user/parallel-preprocessor -v $(pwd)/parallel-preprocessor:/home/user/parallel-preprocessor qingfengxia/freecad-daily-python3:latest  /bin/bash</div>
<div class="line"> </div>
<div class="line"># to run docker image locally, you can mapping dir and xwindows</div>
<div class="line"># https://github.com/mviereck/x11docker</div>
</div><!-- fragment --><p>Inside the docker VM, or if you have managed all dep locally, change dir into the repo folder <code>mkdir build &amp;&amp; cd build &amp;&amp; cmake -DPython_EXECUTABLE=$(which python3) .. &amp;&amp; make -j4</code></p>
<p>It is a CMake project. <code>rm -rf build</code> if you want to rebuild after some change in CMakeLists.txt</p>
<h1>Installation</h1>
<h2>Use without system-wide installation</h2>
<p>Without installation, this software can be evaluated by running <a href="./python/geomPipeline.py">geomPipeline.py path_to_geometry_file</a>, after building from source.</p>
<p>After out of source build in the <code>parallel-preprocessor/build</code> folder by <code>cmake -DPython_EXECUTABLE=$(which python3) .. &amp;&amp; make -j6</code>, change directory to <code>cd parallel-preprocessor/build/ppptest</code>, run <code>python3 geomPipeline.py path-to-your-geometry.stp</code>. User can user absolute or relative path for the input geometry file.</p>
<p>Note: change directory to the folder containing geomPipeline.py is not necessary, if user has put full path of <code>parallel-preprocessor/build/bin/</code> folder into user path. For example, by editing PATH varialbe in <code>~/.bashrc</code> on Ubuntu, it will just work as installed program.</p>
<h3>add <code>bin</code> in the <code>build folder</code> to the user path</h3>
<p>Just append the <code>bin</code>folder to user path in <code>~/.bashrc</code>, that is all. you should be able to imprint geometry by <code>geomPipeline.py input_geometry_path</code>.</p>
<p>This is the recommended way in this development stage, then it is easier to pull and build the latest source. There is no need for super user privilege.</p>
<p>However, unit test application such as <code>pppGeomTests</code> must be run in the <code>build/ppptest</code> folder for the moment, since test data in <code>parallel-preprocessor/build/data</code> are referred using relative path.</p>
<h2>Use after install the deb/rpm package</h2>
<h3>Generate deb/rpm package</h3>
<p>After successfully build this software from source using cmake, <code>make package</code> will generate the platform binary package, deb or rpm (currently, only Ubuntu 18.04 and fedora 30+). see [./Packaging.md] for more details.</p>
<h3>Install parallel processor package</h3>
<p>Precompiled binary packages may be provided in the future.</p>
<p>Platform package rpm and deb has been generated in the build directory, install it. <code>sudo rpm -i parallel-preprocessor*</code> on RedHat systems or <code>sudo dpkg -i parallel-preprocessor*</code> on debian/ubuntu</p>
<p>Note, super user privilege may be needed, depending on install prefix specified in cmake configuraton.</p>
<h3>Use after installation</h3>
<p>All python scripts and binary programs are installed to path, so there is no need to specify <code>geomPipeline.py</code> path. It can be run as a python3 script executable <code>geomPipeline.py &lt;your_geometry_file_path&gt;</code></p>
<h2>Install python conda package</h2>
<p>A conda package can be generated to support more Linux platforms.</p>
<p>However, it is not completed and tested yet since there is built C-extension module involved. User should install all the necessary dependency, such as OpenCASCADE 7.x, TBB, FreeCAD. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
