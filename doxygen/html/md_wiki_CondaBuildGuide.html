<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>parallel-preprocessor: Build for Anaconda</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">parallel-preprocessor
   &#160;<span id="projectnumber">0.3.0.3ee9e97</span>
   </div>
   <div id="projectbrief">MPI distributive and multithreading massively parallel geometry processor     for large scale CAE and machine learning, by Qingfeng Xia, UKAEA, 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_wiki_CondaBuildGuide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Build for Anaconda </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>conda package has both c++ binary and python wrapper installed, just like compiling from source by cmake.</p>
<h2>conda recipe: meta.yaml and build scripts</h2>
<p>The meta.yaml and build scripts have been provided in the <code>recipe</code> folder of this repository.</p>
<p>The package config file <code>meta.yaml</code> can be generated by a command, or just adapted from an existing recipe online, e.g. <a href="https://github.com/conda/conda-recipes/tree/master/libtiff">https://github.com/conda/conda-recipes/tree/master/libtiff</a> Also note that the compilers used by conda-build can be specified using a <code>conda_build_config.yaml</code>.</p>
<p>The build scripts <code>build.sh</code> (for Unix-like OS) and <code>bld.bat</code> (windows batch file) have the install instruction (cmake is called just as compiling from source code.), install to a tmp prefix, then compressed into a zipped file, i.e. conda package. <br  />
</p>
<h2>build conda package</h2>
<p>To build conda package, first of all, install anaconda python3 and install necessary packages like <code>conda-build</code>, and run the command in the <code>recipe</code> folder of this repository: <code>conda build meta.ymal</code></p>
<p>The conda build task is conducted a seperate virtual environment automatically, so is the test(run) process. <br  />
 <code>D:\Software\anaconda3\envs\cf\conda-bld\ppp_1597347412425</code> On windows, cmake isntalled to the <code>base</code> conda environment can still detect <code>occt</code> package installed in the conda-build tmp conda environment.</p>
<p>NOTE: conda will not auto clean those tmp virtual env, user must manually remove the build virtual env.</p>
<h2>build for multiple python versions</h2>
<p>Since python interface module for parallel preprocessor is C-extension, so seperate binary packages are needed for conda python 3.6, 3.7 and 3.8. conda build support build for multiple version, by specify <code>--py</code> option multiple times. <code>conda build --py 3.6 --py 3.7 --py 3.8 recipe</code> if this does not work, try &lsquo;conda build recipe --variants "{'python&amp;rsquo;: ['2.7', '3.6'], 'vc': ['9', '14']}"`</p>
<p>After all, variant control is done by the yaml file<code>conda_build_config.yaml</code>. If this file does not exists same directory as<code>meta.yaml</code>, <code>conda build</code> may generate one. real also <a href="https://medium.com/@MaheshSawaiker/conda-multi-variant-builds-8edc35c215d7">Conda multi variant builds</a> </p><div class="fragment"><div class="line">python:</div>
<div class="line">    - 2.7</div>
<div class="line">    - 3.5</div>
<div class="line">    - 3.6</div>
</div><!-- fragment --><h2>install built local conda package</h2>
<p>Where is the generated conda package? <br  />
 If testing script passed, the generated conda package, a compressed file, should be copied to the current working directory. <br  />
 If test failed, there may be error message: </p><blockquote class="doxtable">
<p>Tests failed for ppp-0.3-hdef9aff_2003.tar.bz2 - moving package to D:\Software\anaconda3\envs\cf\conda-bld\broken </p>
</blockquote>
<p>After conda build, the built package can be installed: <code>conda install --use-local ppp</code> or equally <code>conda install -c local ppp</code> to install the built pkg. <code>conda install --use-local ppp --dry-run</code> to test if built package can be found and installed. <code>conda verify</code> may also verify the package without installation.</p>
<p>It is expected binary conda package for parallel-preprocessor will be hosted on github or conda-forge. After downloaded from github Release, the compressed package file can be installed by the command</p>
<div class="fragment"><div class="line">conda install /package-path/package-filename.tar.bz2</div>
</div><!-- fragment --><h2>upload to conda forge (yet done)</h2>
<p>Here is guide from conda-forge website: </p><blockquote class="doxtable">
<p>If your package is not on conda-forge yet you can follow their contribution documentation here: <a href="https://conda-forge.org/#add_recipe">https://conda-forge.org/#add_recipe</a> </p>
</blockquote>
<p>The process: fork conda-forge example repo, and push it as a new repo, later the maintainer (pusher) will have the write control on that repo.</p>
<p><code>conda config --set anaconda_upload yes</code></p>
<h2>Gitlab CI and github workflow for conda build</h2>
<p><a href="https://github.com/conda/conda-gitlab-ci">https://github.com/conda/conda-gitlab-ci</a></p>
<p>Use <b>github Release</b> to host built binary conda packages, instead of conda-forge for the moment, before conda-forge is ready.</p>
<p><a href="https://github.com/marketplace/actions/setup-miniconda">https://github.com/marketplace/actions/setup-miniconda</a></p>
<p><a href="https://github.com/actions/upload-release-asset">https://github.com/actions/upload-release-asset</a></p>
<p>github workflow: how to control visual studio version for “windows-latest”? </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
